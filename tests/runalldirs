#!/bin/sh

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
ROOT_DIR="$(dirname "$SCRIPT_DIR")"

export TRI_CMD="$ROOT_DIR/tri-pp"

echo "Using TRI_CMD=$TRI_CMD"

ERRORS=0

run_test() {
    "$@"
    if [ $? -ne 0 ]; then
        ERRORS=1
    fi
}

# Define test suites
run_test "$SCRIPT_DIR/rundir" "$SCRIPT_DIR/unused_decl_commenter" "" "-q"
run_test "$SCRIPT_DIR/rundir" "$SCRIPT_DIR/typedef_remover" "" "-q"
run_test "$SCRIPT_DIR/rundir" "$SCRIPT_DIR/program_transformations" "" "-q"

if [ $ERRORS -ne 0 ]; then
    exit 1
fi

exit 0
